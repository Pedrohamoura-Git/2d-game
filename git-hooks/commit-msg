#!/bin/sh

# Get the current Git branch name
full_branch_name=$(git rev-parse --abbrev-ref HEAD)

# Extract the part of the branch name after the first "/"
branch_name=$(echo "$full_branch_name" | sed 's:.*/::')

# Get the commit message from the argument
commit_message=$(cat "$1")

# Bypass validation for merge commits
case "$commit_message" in
  Merge*)
    exit 0
    ;;
esac

# Define valid commit types and their corresponding emojis (sorted alphabetically)
case "$commit_message" in
  asset:*)
    emoji="ðŸ±"
    ;;
  build:*)
    emoji="ðŸ—"
    ;;
  chore:*)
    emoji="ðŸ§¹"
    ;;
  ci:*)
    emoji="ðŸ‘·"
    ;;
  config:*)
    emoji="ðŸ”§"
    ;;
  comment:*)
    emoji="ðŸ’¡"
    ;;
  db:*)
    emoji="ðŸ—ƒï¸"
    ;;
  del:*)
    emoji="ðŸ”¥"
    ;;
  dep_new:*)
    emoji="âž•"
    ;;
  dep_del:*)
    emoji="âž–"
    ;;
  dep_down:*)
    emoji="ðŸ“‰"
    ;;
  dep_up:*)
    emoji="ðŸ“ˆ"
    ;;
  dev:*)
    emoji="ðŸ‘¨â€ðŸ’»"
    ;;
  doc:*)
    emoji="ðŸ“"
    ;;
  feat:*)
    emoji="âœ¨"
    ;;
  fix:*)
    emoji="ðŸ›"
    ;;
  hotfix:*)
    emoji="ðŸš‘ï¸"
    ;;
  intl:*)
    emoji="ðŸŒ"
    ;;
  lint:*)
    emoji="ðŸš¨"
    ;;
  log:*)
    emoji="ðŸ”Š"
    ;;
  perf:*)
    emoji="âš¡ï¸"
    ;;
  refac:*)
    emoji="â™»ï¸"
    ;;
  responsive:*)
    emoji="ðŸ“±"
    ;;
  revert:*)
    emoji="âª"
    ;;
  role:*)
    emoji="ðŸ›‚"
    ;;
  style:*)
    emoji="ðŸŽ¨"
    ;;
  tada:*)
    emoji="ðŸŽ‰"
    ;;
  test:*)
    emoji="ðŸ§ª"
    ;;
  type:*)
    emoji="ðŸ·ï¸"
    ;;
  wip:*)
    emoji="ðŸš§"
    ;;
  *)
    # If the type is invalid, show an error and exit
    echo "Error: Invalid commit type. Please use one of the following types: build, chore, ci, config, comment, db, del, dep_new, dep_del, dep_down, dep_up, dev, doc, feat, fix, hotfix, intl, log, perf, refac, responsive, revert, role, style, tada, test, type, and wip"
    exit 1
    ;;
esac

# Modify the commit message with emoji and branch name if the type is valid
new_message="$emoji | ${commit_message%%:*}($branch_name):${commit_message#*:}"

# Overwrite the commit message with the new format
echo "$new_message" > "$1"

